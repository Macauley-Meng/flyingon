
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--以IE的当前版本渲染,如果安装了ChromeFrame则优先使用-->
    <!--<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />-->
    <!--<meta http-equiv="X-UA-Compatible" content="IE=7" />-->
    <title></title>
    <style type="text/css">
        * {
            font-size: 12px;
            font-family: Arial;
        }

        #tool span {
            padding-left: 2px;
        }

        #tool input {
            margin-left: 2px;
        }
    </style>
</head>
<body style="margin: 0;">

    <div style="width: 100%; height: 100%;">

        <div id="tool">

            <div id="drag" style="border:1px solid black; padding:2px; background-color: yellow;">

                <input type="button" value="line" onclick="layout('line')" />
                <input type="button" value="flow" onclick="layout('flow')" />
                <input type="button" value="dock" onclick="layout('dock')" />
                <input type="button" value="cascade" onclick="layout('cascade')" />
                <input type="button" value="page" onclick="layout('page')" />
                <input type="button" value="grid" onclick="layout('grid')" />
                <input type="button" value="table" onclick="layout('table')" />
                <input type="button" value="absolute" onclick="layout('absolute')" />

                <span style="width: 10px"></span>
                <input type="button" value="horizontal" onclick="vertical(false)" />
                <input type="button" value="vertical" onclick="vertical(true)" />

                <span style="width: 10px"></span>
                <input type="button" value="ltr" onclick="direction('ltr')" />
                <input type="button" value="rtl" onclick="direction('rtl')" />

                <span style="width: 10px"></span>
                <input type="button" value="Paint" onclick="paint()" />
                <span style="width: 10px"></span>
                <span style="color:red;">可点击Button选择控件及调整参数 可拖动Panel或Button调整位置或大小</span>
            </div>

            <table style="border:1px solid black;">
                <tr>
                    <td style="width:60px;">面板参数:</td>
                    <td>
                        <div id="panel_property" style="padding:2px;">
                            <span>spacingWidth<input type="text" style="width:40px;" value="10px" onchange="sync_panel()" /></span>
                            <span>spacingHeight<input type="text" style="width:40px;" value="10px" onchange="sync_panel()" /></span>
                            <span tag="flow">layoutWidth<input type="text" style="width:40px;" value="0" onchange="sync_panel()" /></span>
                            <span tag="flow">layoutHeight<input type="text" style="width:40px;" value="0" onchange="sync_panel()" /></span>
                            <span style="display: none;" tag="page">layoutPage<input type="text" style="width:40px;" value="0" onchange="sync_panel()" /></span>
                            <span style="display: none;" tag="grid">layoutRows<input type="text" style="width: 100px; " value="8" onchange="sync_panel()" /></span>
                            <span style="display: none;" tag="grid">layoutColumns<input type="text" style="width: 100px; " value="8" onchange="sync_panel()" /></span>
                            <span style="display: none;" tag="table">layoutTable<input type="text" style="width: 400px; " value="*[50% * *] *[* 50% {(spacingWidth=50%,spacingHeight=50%) *[* * *] *[* * *] *[* * *]} *] *[* * * *]" onchange="sync_panel()" /></span>
                            <span style="display: none;" tag="table">layoutTables<input type="text" style="width: 400px; " value="[ [300, 300, '*[* * *] ...2' ], [ 400, 400, '*[* * * *] ...3'] ]" onchange="sync_panel()" /></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="width:60px;">控件参数:</td>
                    <td>
                        <div id="button_property" style="padding:2px;">

                            <span>minWidth<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>maxWidth<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>

                            <span>minHeight<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>maxHeight<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>

                            <span>offsetX<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>offsetY<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>

                            <span>alignX<input type="text" style="width:40px;" value="center" onchange="sync_button()" /></span>
                            <span>alignY<input type="text" style="width:40px;" value="middle" onchange="sync_button()" /></span>

                            <span>marginLeft<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>marginTop<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>marginRight<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span>marginBottom<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>

                            <span tag="flow">newline<input type="text" style="width:40px;" value="false" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="dock">dock<input type="text" style="width: 50px; " value="left" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="grid">rowSpan<input type="text" style="width: 50px; " value="0" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="grid">columnSpan<input type="text" style="width: 50px; " value="0" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="grid">columnIndex<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="grid">spacingCells<input type="text" style="width: 50px;" value="0" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="absolute">left<input type="text" style="width:40px;" value="0" onchange="sync_button()" /></span>
                            <span style="display: none;" tag="absolute">top<input type="text" style="width: 50px;" value="0" onchange="sync_button()" /></span>

                        </div>
                    </td>
                </tr>
            </table>

        </div>

        <div id="host" style="width: 100%; height: 600px;">
        </div>

    </div>


    <script src="../scripts/flyingon.js"></script>
    <script src="../themes/default/flyingon.js"></script>

    <script type="text/javascript">



        var inputs = tool.getElementsByTagName("input");

        for (var i = 0; i < inputs.length; i++)
        {
            inputs[i].onkeydown = function (event) {

                event = event || window.event;

                if (event.keyCode === 13)
                {
                    this.blur();
                }
            };
        }


        var date = new Date();


        var w = new flyingon.Window(host).sets({

            layoutType: "flow",
            padding: "10px",
            border: "4px solid blue",
            spacingWidth: "10px",
            spacingHeight: "10px"
        });


        for (var k = 0; k < 100; k++)
        {
            var panel = new flyingon.Panel().sets({

                width: "500px",
                border: "4px solid red",
                padding: "10px",
                droppable: true,
                resizable: "both",
                layoutType: "flow",
                spacingWidth: "10px",
                spacingHeight: "10px",

                layoutColumns: "8", //4
                layoutRows: "8",   //4

                layoutTable: "*[50% * *] *[* 50% {(spacingWidth=50%,spacingHeight=50%) *[* * *] *[* * *] *[* * *]} *] *[* * * *]",
                layoutTables: "[ [300, 300, '*[* * *] ...2' ], [ 400, 400, '*[* * * *] ...3'] ]"
            });

            for (var i = 0; i < 100; i++)
            {

                var ctrl = new flyingon.Button().sets({

                    left: i % 5 * 120 + "px",
                    top: i / 5 * 30 + "px",
                    draggable: "both",
                    resizable: "both",
                    text: "button" + i
                });

                switch (i % 5)
                {
                    case 0:
                        ctrl.set_dock("left");
                        break;

                    case 1:
                        ctrl.set_dock("top");
                        break;

                    case 2:
                        ctrl.set_dock("right");
                        break;

                    case 3:
                        ctrl.set_dock("bottom");
                        break;

                    case 4:
                        ctrl.set_dock("fill");
                        break;
                }

                panel.appendChild(ctrl);
            }

            w.appendChild(panel);
        }


        alert(new Date() - date);




        function sync_panel() {

            var nodes = panel_property.getElementsByTagName("span"),
                children = w.get_children();

            for (var i = 0; i < nodes.length; i++)
            {
                var node = nodes[i];
                var name = node.innerText || node.textContent;

                for (var j = 0; j < children.length; j++)
                {
                    children[j].set(name, node.children[0].value);
                }
            }
        };




        function paint() {

            var date = new Date();

            w.update(true);
            w.render();

            alert(new Date() - date);
        };


        function layout(value) {

            var nodes = tool.getElementsByTagName("span");

            for (var i = 0; i < nodes.length; i++)
            {
                var node = nodes[i];
                var attr = node.getAttribute("tag");

                node.style.display = attr && attr !== value ? "none" : "";
            }

            var date = new Date();

            children = w.get_children();

            for (var i = 0; i < children.length; i++)
            {
                var panel = children[i];
                panel.set_layoutType(value);
            }

            w.render();

            alert(new Date() - date);
        };


        function vertical(value) {

            var date = new Date();

            var children = w.get_children();

            for (var i = 0; i < children.length; i++)
            {
                var panel = children[i];
                panel.set_vertical(value);
            }

            w.render();

            alert(new Date() - date);
        };


        function direction(value) {

            var date = new Date();

            var children = w.get_children();

            for (var i = 0; i < children.length; i++)
            {
                var panel = children[i];
                panel.set_direction(value);
            }

            w.render();

            alert(new Date() - date);
        };




        var button = w.get_children()[0].get_children()[0];


        function sync_button() {

            if (button)
            {
                var nodes = button_property.getElementsByTagName("span");

                for (var i = 0; i < nodes.length; i++)
                {
                    var node = nodes[i],
                        name = node.innerText || node.textContent,
                        value = node.children[0].value;

                    switch (name)
                    {
                        case "newline":
                            button.set(name, value && value !== "false");
                            break;

                        case "alignX":
                            if (value !== "left" && value !== "center" && value !== "right")
                            {
                                alert("可选值: left, center, right");
                            }
                            else
                            {
                                button.set(name, value);
                            }
                            break;

                        case "alignY":
                            if (value !== "top" && value !== "middle" && value !== "bottom")
                            {
                                alert("可选值: top, middle, bottom");
                            }
                            else
                            {
                                button.set(name, value);
                            }
                            break;

                        default:
                            button.set(name, value);
                            break;
                    }

                }
            }
        };

        sync_button();



        w.on("mousedown", function (event) {

            if (event.target.is(flyingon.Button))
            {
                var nodes = button_property.getElementsByTagName("span");

                button = event.target;

                for (var i = 0; i < nodes.length; i++)
                {
                    var node = nodes[i];
                    var name = node.innerText || node.textContent;

                    node.children[0].value = button.get(name);
                }
            }

        });



    </script>

</body>
</html>
